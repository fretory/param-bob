name: Deploy to GitHub Pages

on:
  push:
    branches:
      - master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install Dependencies
        run: npm ci

      - name: Check Config Files
        run: |
          mkdir -p config
          cat > config/tools.yaml << EOL
          - name: "示例工具"
            description: "这是一个示例工具配置"
            commands:
              - name: "示例命令"
                template: "echo 'Hello World'"
                params:
                  - name: "message"
                    description: "要显示的消息"
                    type: "string"
                    default: "Hello World"
          EOL

      - name: Type Check
        run: npm run type-check
        continue-on-error: true

      - name: Build
        run: npm run build

      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: dist
          branch: gh-pages
          token: ${{ secrets.ACCESS_TOKEN }}